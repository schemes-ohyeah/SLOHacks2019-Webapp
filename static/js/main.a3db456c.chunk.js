(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{157:function(e,t,n){e.exports=n.p+"static/media/logo.3fa51164.png"},168:function(e,t,n){e.exports=n(357)},173:function(e,t,n){},357:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(32),i=n.n(c),r=n(11),s=n(12),l=n(24),u=n(23),m=n(25),d=n(361),p=n(279),h=n(266),f=n(108),g=n(158),v=n.n(g),S=n(159),b=n.n(S),O=n(45),y=n.n(O),E=n(160),w=n.n(E),k=n(69),A=n.n(k),j=n(70),T=n.n(j),C=n(71),R=n.n(C),_=n(161),P=n.n(_),N=n(162),D=n.n(N),U=n(164),L=n.n(U),z=n(72),I=n.n(z),x=n(163),M=n.n(x),B=n(359),W=n(155),J=n.n(W),V=(n(173),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).initAudioRecorder=function(){var e=new webkitSpeechRecognition;e.lang="en-US",e.interimResults=!1,e.maxAlternatives=1,e.onresult=function(e){var t=e.results[0][0].transcript;n.props.sendRecognizedSpeech(t)},e.start(),n.speechRecognition=e},n.speechRecognition=void 0,n.initAudioRecorder(),n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"mic-icon-animation",onClick:function(){return e.speechRecognition.start()}},o.a.createElement(J.a,null))}}]),t}(o.a.Component)),H=n(111);H.initializeApp({apiKey:"AIzaSyA_0IhKpkkLMrzIl4zS8N306XibgNoRTP4",authDomain:"slohacks-dog-instrucc.firebaseapp.com",databaseURL:"https://slohacks-dog-instrucc.firebaseio.com",projectId:"slohacks-dog-instrucc",storageBucket:"",messagingSenderId:"504644134709"});var K=function(){function e(){Object(r.a)(this,e)}return Object(s.a)(e,null,[{key:"addCommand",value:function(t){return e.db.collection("commands").add({name:t,successRate:0,timestamp:(new Date).toISOString()})}},{key:"listCommands",value:function(){return e.db.collection("commands").orderBy("timestamp","desc").get().then(function(e){return new Promise(function(t){var n=[];e.forEach(function(e){var t=e.data();t.id=e.id,n.push(t)}),t(n)})})}},{key:"getCommand",value:function(t){return e.db.collection("commands").doc(t).get().then(function(e){return e.data()})}},{key:"listAttempts",value:function(t){return e.db.collection("commands").doc(t).collection("attempts").orderBy("timestamp","desc").get().then(function(e){return new Promise(function(t){var n=[];e.forEach(function(e){var t=e.data();t.id=e.id,n.push(t)}),t(n)})})}},{key:"getFirstAttempt",value:function(t){return e.db.collection("commands").doc(t).collection("attempts").orderBy("timestamp").limit(1).get().then(function(e){return new Promise(function(t){var n={};e.forEach(function(e){(n=e.data()).id=e.id}),t(n)})})}},{key:"getAttempt",value:function(t,n){return e.db.collection("commands").doc(t).collection("attempts").doc(n).get().then(function(e){return e.data()})}},{key:"updateAttempt",value:function(t,n,a){return e.db.collection("commands").doc(t).collection("attempts").doc(n).update({success:a})}},{key:"validateAttempt",value:function(t,n){return new Promise(function(a){e.getAttempt(t,n).then(function(o){e.getFirstAttempt(t).then(function(c){console.log(c.id,n),c.id===n?e.calibrate(t,n,a):e.findError(c,o,t,n,a)})})})}},{key:"calibrate",value:function(t,n,a){e.updateAttempt(t,n,!0).then(function(){e.normalizeCommandSuccess(t).then(function(){return a(!0)})})}},{key:"findError",value:function(t,n,a,o,c){var i={reference:JSON.parse(t.measurements),recent:JSON.parse(n.measurements)};fetch("https://us-central1-slohacks-dog-instrucc.cloudfunctions.net/function-2",{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(t){var n=t.error_x+t.error_y+t.error_z;console.log(n);var i=n<100;e.updateAttempt(a,o,i).then(function(){e.normalizeCommandSuccess(a).then(function(){c(i)})})}).catch(function(i){console.error(i),e.findError(t,n,a,o,c)})}},{key:"normalizeCommandSuccess",value:function(t){return e.listAttempts(t).then(function(n){var a=n.filter(function(e){return e.success}).length/n.length;return e.db.collection("commands").doc(t).update({successRate:a})})}}]),e}();K.db=H.firestore();var F=n(68),G=n.n(F),X=n(360),Y=n(157),$=n.n(Y),q=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("img",{src:$.a,style:{height:"1rem"},alt:"Dog icon"})}}]),t}(o.a.PureComponent),Q=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).acceptVoiceSample=function(){n.modalOff(),K.addCommand(n.state.voiceSample.toLowerCase()).then(function(e){n.props.history.push("/detail/".concat(e.id))})},n.modalOn=function(){n.setState({determinedVoiceSample:!1,showModal:!0,voiceSample:""})},n.modalOff=function(){n.setState({showModal:!1})},n.receiveRecognizedSpeech=function(e){n.setState({determinedVoiceSample:!0,voiceSample:e})},n.state={commands:void 0,determinedVoiceSample:!1,showModal:!1,voiceSample:""},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;K.listCommands().then(function(t){return e.setState({commands:t})})}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",null,o.a.createElement(v.a,{position:"static"},o.a.createElement(b.a,null,o.a.createElement(y.a,{variant:"h6",color:"inherit",className:e.grow},o.a.createElement(q,null)," Dog Instrucc"))),void 0===this.state.commands?o.a.createElement(G.a,null):o.a.createElement(A.a,null,0===this.state.commands.length?o.a.createElement(y.a,{style:{padding:"1rem"}},"No entries yet. Click the button at the bottom to get started!"):this.state.commands.map(function(e){var t=e.name[0].toUpperCase()+e.name.substring(1),n=Math.round(100*e.successRate);return o.a.createElement(T.a,{button:!0,component:B.a,key:e.id,to:"/detail/".concat(e.id)},o.a.createElement(R.a,{primary:t,secondary:"".concat(isNaN(n)?0:n,"%")}))})),o.a.createElement(w.a,{className:e.fab,color:"secondary",onClick:this.modalOn},o.a.createElement("i",{className:"fas fa-paw"})),o.a.createElement(P.a,{open:this.state.showModal,onClose:this.state.modalOff},o.a.createElement(D.a,null,"Speak a voice command"),o.a.createElement(M.a,{className:e.dialogContent},o.a.createElement(V,{sendRecognizedSpeech:this.receiveRecognizedSpeech}),o.a.createElement(y.a,null,this.state.voiceSample)),o.a.createElement(L.a,null,o.a.createElement(I.a,{onClick:this.modalOff,color:"secondary"},"Cancel"),o.a.createElement(I.a,{onClick:this.acceptVoiceSample,color:"primary",disabled:!this.state.determinedVoiceSample},"OK"))))}}]),t}(o.a.Component),Z=Object(X.a)(Object(f.withStyles)(function(e){return{root:{backgroundColor:e.palette.background.paper,width:500,position:"relative",minHeight:200},fab:{position:"absolute",bottom:2*e.spacing.unit,right:2*e.spacing.unit},dialogContent:{textAlign:"center"}}})(Q)),ee=n(105),te=n.n(ee),ne=n(106),ae=n.n(ne),oe=n(46),ce=n.n(oe),ie=n(107),re=n.n(ie),se=n(269),le=n.n(se),ue=n(270),me=n.n(ue),de=n(74),pe=n(275),he=n.n(pe),fe=n(276),ge=n.n(fe),ve=n(277),Se=n.n(ve),be=n(271),Oe=n.n(be),ye=n(272),Ee=n.n(ye),we=n(268),ke=n.n(we),Ae=n(110),je=n.n(Ae),Te=n(67),Ce=n.n(Te),Re=n(273),_e=n.n(Re),Pe=n(274),Ne=n.n(Pe),De=function(){function e(){Object(r.a)(this,e)}return Object(s.a)(e,null,[{key:"startAccelerometer",value:function(t){return fetch(e.IP_ADDRESS,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({command_id:t})}).then(function(e){return e.status})}},{key:"stopAccelerometer",value:function(){return fetch(e.IP_ADDRESS,{method:"GET"}).then(function(e){return e.text()})}}]),e}();De.IP_ADDRESS="http://192.168.137.65:8080";var Ue=function(){function e(){Object(r.a)(this,e)}return Object(s.a)(e,null,[{key:"speak",value:function(e){return fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key=".concat("AIzaSyA_0IhKpkkLMrzIl4zS8N306XibgNoRTP4"),{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({audioConfig:{audioEncoding:"MP3",pitch:"0.00",speakingRate:"1.00"},input:{text:e},voice:{languageCode:"en-US",name:"en-US-Wavenet-B"}})}).then(function(e){return e.json()}).then(function(e){return new Audio("data:audio/mp3;base64,".concat(e.audioContent)).play()}).catch(function(e){return console.error(e)})}}]),e}(),Le=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).getData=function(){K.getCommand(n.props.match.params.id).then(function(e){return n.setState({commandDetail:e})}),K.listAttempts(n.props.match.params.id).then(function(e){n.setState({attempts:e,loopStatus:t.LOOP_STATUS.idle})})},n.handleLoopStatusUpdate=function(){n.state.loopStatus===t.LOOP_STATUS.idle?n._startRecording():n.state.loopStatus===t.LOOP_STATUS.recording?n._stopRecording():n.state.loopStatus===t.LOOP_STATUS.wait||(alert("Oh no, something went wrong. :("),n.setState({loopStatus:t.LOOP_STATUS.idle}))},n._startRecording=function(){n.setState({loopStatus:t.LOOP_STATUS.wait},n._moveDog)},n._stopRecording=function(){n.setState({loopStatus:t.LOOP_STATUS.wait},n._processData)},n._moveDog=function(){Ue.speak(n.state.commandDetail.name),De.startAccelerometer(n.props.match.params.id).then(function(e){201===e?n.setState({loopStatus:t.LOOP_STATUS.recording}):(console.warn(e,"Something went wrong. Restarting process."),n.setState({loopStatus:t.LOOP_STATUS.idle}))})},n._processData=function(){De.stopAccelerometer().then(function(e){K.validateAttempt(n.props.match.params.id,e).then(function(){n.getData()})})},n.state={attempts:void 0,commandDetail:void 0,loopStatus:t.LOOP_STATUS.idle},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.getData()}},{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",null,o.a.createElement(te.a,{position:"static"},o.a.createElement(ae.a,null,o.a.createElement(le.a,{className:e.menuButton,color:"inherit","aria-label":"back",component:B.a,to:"/"},o.a.createElement(me.a,null)),o.a.createElement(ce.a,{variant:"h6",color:"inherit",className:e.grow},o.a.createElement(q,null)," Command Training"))),void 0===this.state.commandDetail?o.a.createElement(G.a,null):o.a.createElement("div",null,o.a.createElement(ce.a,{className:e.title,variant:"h2"},this.successRate,"%"),o.a.createElement(ce.a,{className:e.title,variant:"h6"},this.title),o.a.createElement(A.a,null,this.state.attempts?this.state.attempts.map(function(t,n){return o.a.createElement(T.a,{key:n},o.a.createElement(Oe.a,null,o.a.createElement(Ee.a,{className:t.success?e.successAvatar:e.failAvatar},t.success?o.a.createElement(_e.a,null):o.a.createElement(Ne.a,null))),o.a.createElement(R.a,{primary:ke()(t.timestamp).fromNow()}))}):o.a.createElement(ce.a,{style:{padding:"1rem"}},"No entries yet. Click the button at the bottom to start recording!"))),o.a.createElement(re.a,{className:e.fab,color:"secondary",disabled:this.state.loopStatus===t.LOOP_STATUS.wait,onClick:this.handleLoopStatusUpdate},this.state.loopStatus===t.LOOP_STATUS.idle&&o.a.createElement(he.a,null),this.state.loopStatus===t.LOOP_STATUS.recording&&o.a.createElement(ge.a,null),this.state.loopStatus===t.LOOP_STATUS.wait&&o.a.createElement(Se.a,null)))}},{key:"successRate",get:function(){if(void 0===this.state.commandDetail)return 0;var e=Math.round(100*this.state.commandDetail.successRate);return isNaN(e)?0:e}},{key:"title",get:function(){return void 0===this.state.commandDetail?"":this.state.commandDetail.name[0].toUpperCase()+this.state.commandDetail.name.substring(1)}}]),t}(o.a.Component);Le.LOOP_STATUS={idle:0,recording:1,wait:2};var ze=Object(de.a)(function(e){return{grow:{flexGrow:1},menuButton:{marginLeft:-12,marginRight:10},fab:{position:"absolute",bottom:2*e.spacing.unit,right:2*e.spacing.unit},successAvatar:{margin:10,backgroundColor:je.a[400]},failAvatar:{margin:10,backgroundColor:Ce.a[500]},title:{marginTop:20,textAlign:"center"}}})(Le),Ie=n(278),xe=n.n(Ie),Me=n(109),Be=n.n(Me),We=n(53),Je=n.n(We),Ve=n(267),He=Je()({palette:{primary:{main:Ve.green[400]},secondary:{main:Ve.brown[600]}}}),Ke=function(e){function t(){return Object(r.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement(Be.a,{theme:He},o.a.createElement("div",{className:this.props.classes.root},o.a.createElement(xe.a,null),o.a.createElement(d.a,null,o.a.createElement(p.a,null,o.a.createElement(h.a,{component:Z,exact:!0,path:"/"}),o.a.createElement(h.a,{component:ze,path:"/detail/:id"})))))}}]),t}(a.Component),Fe=Object(de.a)(function(e){return{root:{backgroundColor:e.palette.background.paper,height:"100vh",overflowY:"scroll"}}})(Ke),Ge=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Xe(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(o.a.createElement(Fe,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");Ge?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Xe(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Xe(t,e)})}}()}},[[168,2,1]]]);
//# sourceMappingURL=main.a3db456c.chunk.js.map